SELECT        STOK.CODE, STOK.NAME, SUM(ORFL.AMOUNT) AS MÄ°KTAR, SUM(ORFL.SHIPPEDAMOUNT) AS SEVKEDILEN, SUM(ORFL.AMOUNT - ORFL.SHIPPEDAMOUNT) AS [KALAN MIKTAR], SUM(ORFL.AMOUNT - ORFL.SHIPPEDAMOUNT) 
                         *
                             (SELECT        TOP (1) PRICE
                               FROM            dbo.LG_125_01_ORFLINE AS ORFL2
                               WHERE        (STOCKREF = STOK.LOGICALREF) AND (TRCODE = 1) AND (CLOSED = 0)
                               ORDER BY LOGICALREF DESC) AS [KALAN TUTAR]
FROM            dbo.LG_125_01_ORFLINE AS ORFL INNER JOIN
                         dbo.LG_125_ITEMS AS STOK ON ORFL.STOCKREF = STOK.LOGICALREF
WHERE        (ORFL.TRCODE = 1) AND (ORFL.STATUS IN (1, 4)) AND (ORFL.CLOSED = 0)
GROUP BY STOK.CODE, STOK.NAME, STOK.LOGICALREF, ORFL.STOCKREF, STOK.CARDTYPE
HAVING        (STOK.CARDTYPE = 12)